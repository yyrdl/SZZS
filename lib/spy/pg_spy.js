var infoCollector=require("../collector");var tools=require("../tool");function addSpy(pg){var origin_client=pg.Client;var origin_query=origin_client.prototype.query;origin_client.prototype.query=function(){var self=this,sql=arguments[0],parameter=arguments[1],ori_cb=arguments[2],record={"type":"pg","host_ip":tools.localIPV4Adress,"host_name":tools.hostName,"server_ip":self.host,"server_port":self.port,"database":self.database,"sql":sql,"parameter":parameter,"is_error":false,"error":"","time_cost":"","dest":self.host+":"+self.port+"/"+self.database};var s_start=Date.now();function cb(err,res){err&&(record.is_error=true,record.error=err.message?err.message:err.toString());record.time_cost=(Date.now()-s_start);tools.realAsync(record,infoCollector.collect);(ori_cb&&(typeof ori_cb)==="function")&&(ori_cb(err,res));}
var args=[sql,parameter,cb];var ret=origin_query.apply(this,args);if(ret!==undefined){return ret;}};pg.Client=origin_client;return pg;}
exports.addSpy=addSpy;